#!/usr/bin/env bash

# Set your wallpaper directory
WALLPAPER_DIR="${HOME}/wallpaper"

# Pick a random wallpaper
WALLPAPER=$(find "${WALLPAPER_DIR}" -type f \( -iname "*.jpg" -o -iname "*.png" -o -iname "*.jpeg" \) | shuf -n 1)

# Ensure hyprpaper is actually running
if ! pgrep -x "hyprpaper" > /dev/null; then
    hyprpaper &
    # Wait a moment for the socket to initialize
    sleep 0.5
fi

# Wait for the hyprpaper IPC socket to exist
# The instance signature is used to find the correct socket path
while [ ! -e "$XDG_RUNTIME_DIR/hypr/$(echo $HYPRLAND_INSTANCE_SIGNATURE)/.hyprpaper.sock" ]; do
    sleep 0.1
done

hyprctl hyprpaper wallpaper ,"${WALLPAPER}"
